<h1>Intro</h1><p>This post is more like a notebook for setting up the home lab server.</p><h1>Networking</h1><h2>Firewall</h2><h3>Setting correct default zone</h3><p>When listing all zones:</p><pre><code class="language-shell">firewall-cmd --list-all-zones
</code></pre><p>the <code>public</code> default zone is not connected to <code>enp2s0</code> in <code>firewall-cmd</code> so it is useful to change it to a correct 
(<code>FedoraServer</code>) one:</p><pre><code class="language-shell">firewall-cmd --set-default-zone=FedoraServer
</code></pre><h3>Allowing denied logs to appear in <code>journalctl</code></h3><ul><li><p>Change line <code>LogDenied=off</code> to <code>LogDenied=all</code> in <code>vi /etc/firewalld/firewalld.conf</code> file.</p></li><li><p>Restart service: <code>systemctl restart firewalld</code></p></li><li><p>View rejected request logs (last 20 records): <code>journalctl --lines=20 --grep='REJECT'</code> or in follow mode:
  <code>journalctl -f --grep='REJECT'</code></p></li></ul><h3>Adding Wireguard service to allow VPN connection</h3><pre><code class="language-shell">firewall-cmd --add-service=wireguard
</code></pre><p>Add other conf options, so that it will look like:</p><pre><code class="language-text">FedoraServer (default, active)
  target: default
  ingress-priority: 0
  egress-priority: 0
  icmp-block-inversion: no
  interfaces: enp2s0
  sources: 
  services: wireguard
  ports: 
  protocols: 
  forward: yes
  masquerade: yes
  forward-ports: 
  source-ports: 
  icmp-blocks: 
  rich rules: 

home (active)
  target: ACCEPT
  ingress-priority: 0
  egress-priority: 0
  icmp-block-inversion: no
  interfaces: wg0
  sources: 
  services: ssh
  ports: 
  protocols: 
  forward: yes
  masquerade: no
  forward-ports: 
  source-ports: 
  icmp-blocks: 
  rich rules: 
</code></pre><h3>Adding <code>/etc/wireguard/wg0.conf</code> config file</h3><ul><li>Save the following content</li></ul><pre><code class="language-shell">[Interface]
Address = 10.0.0.1/24
PrivateKey = &lt;home_lab_private_key&gt;
ListenPort = 51820
MTU = 1280

[Peer]
PublicKey = &lt;first_device_pub_key&gt;
AllowedIPs = 10.0.0.2/32

[Peer]
PublicKey = &lt;second_device_pub_key&gt;
AllowedIPs = 10.0.0.3/32
</code></pre><ul><li>add new interface to Wireguard: </li></ul><pre><code class="language-shell">wg-quick up wg0
</code></pre><ul><li>create persistent service:</li></ul><pre><code class="language-shell">wg-quick down wg0
systemctl enable wg-quick@wg0
systemctl start wg-quick@wg0
</code></pre><ul><li>to connect from the client install client and add connection with the following conf:</li></ul><pre><code class="language-shell">[Interface]
PrivateKey = &lt;first_device_private_key&gt;
ListenPort = 51820
Address = 10.0.0.3/32
DNS = 10.0.0.1

[Peer]
PublicKey = &lt;home_lab_public_key&gt;
AllowedIPs = 0.0.0.0/1, 128.0.0.0/1
Endpoint = homelab.pswidersk.com:51820

</code></pre><h1>Docker</h1><p>Exporting existing containers to compose format:</p><pre><code class="language-shell">docker run --rm -v /var/run/docker.sock:/var/run/docker.sock ghcr.io/red5d/docker-autocompose $(docker ps -aq) &gt; compose.yaml
</code></pre>