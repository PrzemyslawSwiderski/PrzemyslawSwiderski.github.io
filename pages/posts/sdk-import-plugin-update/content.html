<h1><a href="/posts/sdk-import-plugin-update#intro" class="anchor-link" id="intro">Introduction</a></h1><p>Some time ago I created
the <a href="https://plugins.jetbrains.com/plugin/24223-sdk-import/edit/versions/stable/600376">SDK-Import</a> IntelliJ Plugin.
Unfortunately it depends on <code>PythonCore:231.8109.2</code> plugin which is not supporting the new <code>2024.2+</code> IntelliJ versions.
Because of that I had to update it to the latest one and the SDK-Import plugin itself.</p><p>The changes can be viewed in this <a href="https://github.com/PrzemyslawSwiderski/sdk-import-plugin/pull/45">PR</a>.</p><p>In this post I will try to describe how I did it.</p><h2><a href="/posts/sdk-import-plugin-update#intellij-plugin-update" class="anchor-link" id="intellij-plugin-update">Updating to IntelliJ Platform Gradle Plugin</a></h2><p>As noted
in <a href="https://blog.jetbrains.com/platform/2024/07/intellij-platform-gradle-plugin-2-0/#the-importance-of-updating" class="anchor-link" id="the-importance-of-updating">this</a>
link, there are some breaking layout changes introduced in a new IntelliJ version.</p><p>In order to support new IntelliJ versions I had to migrate project build from the old <code>Gradle IntelliJ Plugin</code> to
<code>IntelliJ Platform Gradle Plugin</code>.
There is some <a href="https://plugins.jetbrains.com/docs/intellij/tools-intellij-platform-gradle-plugin-migration.html">guide</a>
provided about how to do that.</p><p>Nevertheless, I faced some issues while doing it.</p><h3><a href="/posts/sdk-import-plugin-update#kover" class="anchor-link" id="kover">Kover</a></h3><p>After changing gradle plugin references in <code>build.gradle.kts</code> to <code>IntelliJ Platform Gradle Plugin</code> the tests started to
failing with the following message:</p><pre><code class="language-text">Could not initialize property keys deprecation map because DeprecatedRuntimeConstants.__$hits$__ field isn't properly named
</code></pre><p>To fix it I had to follow the advice
from <a href="https://github.com/JetBrains/intellij-platform-gradle-plugin/issues/1702">here</a> and
change <code>kover</code> settings block to following:</p><pre><code class="language-kotlin">kover {
    currentProject {
        instrumentation {
            excludedClasses.add(&quot;org.apache.velocity.*&quot;)
        }
    }
}
</code></pre><h3><a href="/posts/sdk-import-plugin-update#junit-5" class="anchor-link" id="junit-5">Junit 5 problem</a></h3><p>As described
in <a href="https://plugins.jetbrains.com/docs/intellij/tools-intellij-platform-gradle-plugin-faq.html#junit5-test-framework-refers-to-junit4" class="anchor-link" id="junit5-test-framework-refers-to-junit4">link</a>
when using <code>testFramework(TestFrameworkType.JUnit5)</code> the tests are failing because of <code>NoClassDefFoundError</code>.
I fixed it in my project by adding <code>testImplementation(&quot;org.junit.vintage:junit-vintage-engine:${libs.versions.junit}&quot;)</code>
to the dependencies section.</p><h3><a href="/posts/sdk-import-plugin-update#verifier" class="anchor-link" id="verifier">Missing <code>runPluginVerifier</code> task</a></h3><p>The new plugin uses <code>verifyPlugin</code> instead so I had to update <code>.github/workflows/build.yml</code> file to run the build
successfully.</p><h3><a href="/posts/sdk-import-plugin-update#autocompletion" class="anchor-link" id="autocompletion">Gradle build file autocompletion</a></h3><p>One issue I struggled to fix were so-called red lines in gradle build files (<code>build.gradle.kts</code>):</p><p><img class="responsive-img" src="/pages/posts/sdk-import-plugin-update/red-lines-gradle.png" alt="Red lines in build script"></img></p><p>It seems like IDE could not resolve some Kotlin dependencies and autocompletion IntelliJ feature was not working because
of that.
Even though Gradle tasks are executed successfully it was pretty annoying that Intellij was complaining.</p><p>What finally resolved the issue ðŸ¤© was removal of <code>.idea</code>, <code>build</code> and <code>.intellijPlatform</code>
directories and restarting the whole project.</p><h3><a href="/posts/sdk-import-plugin-update#plugin-summary" class="anchor-link" id="plugin-summary">IntelliJ Platform Gradle Plugin update summary</a></h3><p>Overall the migration went pretty smooth.
Migration <a href="https://plugins.jetbrains.com/docs/intellij/tools-intellij-platform-gradle-plugin-migration.html">guide</a> was
pretty clear and I also used the updated <a href="https://github.com/JetBrains/intellij-platform-plugin-template">template</a>
repository to check how the new reference files should look like.</p><p>Hopefully the temporary fixes I
mentioned (<a href="/posts/sdk-import-plugin-update#junit-5" class="anchor-link" id="junit-5">Junit 5</a>, <a href="/posts/sdk-import-plugin-update#kover" class="anchor-link" id="kover">Kover</a>) will not
be necessary in the next plugin version and redundant code can be removed.</p><h2><a href="/posts/sdk-import-plugin-update#code-changes" class="anchor-link" id="code-changes">Code changes</a></h2><p>The source code of the plugin itself was not needed to be adjusted.
However, the testing framework had some breaking changes in the new <code>2024.2</code> version.</p><p>Necessary changes in test source code:</p><ul><li>changing <code>@RunInEdt</code> to <code>@RunInEdt(writeIntent = true)</code></li><li>replacing rules<pre><code class="language-kotlin">@JvmField
@RegisterExtension
val projectModel: ProjectModelExtension = ProjectModelExtension()
private val project: Project
    get() = projectModel.project
</code></pre><p>with fixtures helper functions</p><pre><code class="language-kotlin">private val projectModel = customProjectFixture()
private val project: Project
    get() = projectModel.get()
</code></pre></li></ul><p>After that the tests were compiling and green.</p><h2><a href="/posts/sdk-import-plugin-update#summary" class="anchor-link" id="summary">Summary</a></h2><p>Update went successfully.
The new <code>1.2.0</code> SDK-Import plugin was deployed and
is <a href="https://plugins.jetbrains.com/plugin/24223-sdk-import/">ready</a> to be used in the new <code>2024.2</code>
IntelliJ releases ðŸ™‚.</p>