"use strict";(globalThis.webpackChunkpswidersk_page=globalThis.webpackChunkpswidersk_page||[]).push([[7075],{7075:e=>{e.exports='<h2>Problem <a id="problem" href="/posts/central-repo#problem" class="anchor-link">ðŸ”—</a></h2><p>At the time of writing this post, I have 62 GitHub repositories.<br />\nWith monorepos gaining popularity,\nI\'ve noticed that the common practice is to create a new repository for each new project instead of nesting it within an\nexisting collective one. Most of my repositories are, of course, no longer active ðŸ˜….\nNevertheless, there are still 8 projects I want to actively maintain.</p><p>I wanted to find a generic solution that requires as little manual effort as possible ðŸ™‚.</p><p>The solution should primarily do three things:</p><ol><li>Use common configuration and workflow files stored in a single place.</li><li>Automatically update dependencies.</li><li>Auto releases new versions periodically.</li></ol><p>Below, I\'ll describe how I achieved this.</p><h2>Central source of configuration and workflow files <a id="central-source-of-configuration-and-workflow-files" href="/posts/central-repo#central-source-of-configuration-and-workflow-files" class="anchor-link">ðŸ”—</a></h2><p>To have a single source of \'truth\' I found a very cool files sync\nGitHub <a href="https://github.com/wadackel/files-sync-action">action</a>.\nIt basically synchronizes files across multiple repositories based on a YAML configuration file.\nBy synchronizing, I mean, that it can create PRs and merge them automatically.</p><p>In order to use it and apply to my case, I created a\ncentral repository in <strong><a href="https://github.com/PrzemyslawSwiderski/central-repo/tree/main">here</a></strong>.\nIt contains the action workflow, files-sync config files and of course the files I want to reuse across the projects.\nFor my Gradle plugin projects I have the following <code>files-sync-config.yaml</code>:</p><pre><code class="language-yml">settings:\n  pull_request:\n    labels:\n      - &quot;files-sync&quot; # Labels to add for the PRs\n    merge:\n      mode: auto # auto merge PRs once required checks pass\n      strategy: squash # squash before merging\n      delete_branch: true # always remove the branch\n\npatterns:\n  - files:\n      - from: commons/.github\n        to: .github\n      - from: gradle-plugins\n        to: ./\n        exclude:\n          - files-sync-config.yaml\n      - from: gradle-plugins/.github # dotfiles needs to be specified explicitly (https://github.com/wadackel/files-sync-action/issues/215)\n        to: .github\n    repositories: # repositories which will be synchronized\n      - PrzemyslawSwiderski/python-gradle-plugin\n      - PrzemyslawSwiderski/python-uv-gradle-plugin\n      - PrzemyslawSwiderski/terraform-gradle-plugin\n      - PrzemyslawSwiderski/helm-gradle-plugin\n      - PrzemyslawSwiderski/yaml-secrets-gradle-plugin\n</code></pre><p>Important to mention is that for the auto merging to work, it is required to allow it in each repository settings.\nSame applies to squash and delete branch.</p><p>Now, if for instance I change <code>commons/.github/release-drafter.yml</code> file in <code>main</code> branch, action will be invoked.\nProgress of it can be checked in &quot;Actions&quot; tab.\nThe logs of the action can indicate whether the synchronization was successful or not.\nThey are pretty descriptive and look like this:</p><pre><code class="language-log">&gt; Run wadackel/files-sync-action@v3\n\t\nSynchronize 6 files:\n\t\n           Repository: PrzemyslawSwiderski/python-gradle-plugin\n               Branch: files-sync/PrzemyslawSwiderski-central-repo-0\n           Branch SHA: 00adb0a998cb799f08d2e54ee8fec198c52bca3e\n           Commit SHA: 3fbc93bd44fbb7fd925ea049a5b17ac348b9ba56\n               Commit: &quot;chore: sync files with `PrzemyslawSwiderski/central-repo`&quot;\n        Changed Files: 1\n         Pull Request: https://github.com/PrzemyslawSwiderski/python-gradle-plugin/pull/67\n               Labels: files-sync\n            Reviewers: None\n            Assignees: None\n   Pull Request Merge: The pull request was set to auto-merge.\n               Status: Complete\n\n(...)\t\n</code></pre><h2>Dependencies management <a id="dependencies-management" href="/posts/central-repo#dependencies-management" class="anchor-link">ðŸ”—</a></h2><p>My first thought was to use GitHub\'s\nnative <a href="https://docs.github.com/en/code-security/getting-started/dependabot-quickstart-guide">Dependabot</a>.\nAfter exploring <a href="https://github.com/renovatebot/renovate">Renovate</a>, however, I decided to go with the latter.</p><p>The main advantages of Renovate over Dependabot are:</p><ol><li>Open source ðŸ¥°.</li><li>Rich dashboard with better observability.</li><li>Significantly more powerful and capable\n   (it even updates plugin versions for examples in my <code>settings.gradle.kts</code> files!)</li><li>Can group updates into a single PR.</li><li>Highly <a href="https://docs.renovatebot.com/config-overview/">configurable</a> via <code>renovate.json</code> with presets.</li><li>Better scheduled auto merging.</li><li>Is platform-agnostic, can work on GitLab, Bitbucket and more.</li></ol><p>Because Renovate is pretty versatile and supports <a href="https://docs.renovatebot.com/key-concepts/presets/">presets</a>,\nthe <code>renovate.json</code> for my 5 Gradle plugins can look like that:</p><pre><code class="language-json">{\n  &quot;$schema&quot;: &quot;https://docs.renovatebot.com/renovate-schema.json&quot;,\n  &quot;extends&quot;: [\n    &quot;:dependencyDashboard&quot;,\n    &quot;:semanticPrefixFixDepsChoreOthers&quot;,\n    &quot;:ignoreModulesAndTests&quot;,\n    &quot;group:monorepos&quot;,\n    &quot;group:recommended&quot;,\n    &quot;mergeConfidence:age-confidence-badges&quot;,\n    &quot;replacements:all&quot;,\n    &quot;workarounds:all&quot;,\n    &quot;:automergeAll&quot;,\n    &quot;:automergeRequireAllStatusChecks&quot;\n  ],\n  &quot;github-actions&quot;: {\n    &quot;enabled&quot;: false\n  },\n  &quot;ignorePaths&quot;: [\n    &quot;examples/**&quot;\n  ],\n  &quot;minimumReleaseAge&quot;: &quot;2 days&quot;,\n  &quot;prCreation&quot;: &quot;not-pending&quot;\n}\n</code></pre><h2>Auto release <a id="auto-release" href="/posts/central-repo#auto-release" class="anchor-link">ðŸ”—</a></h2><p>IN_PROGRESS</p><h2>Summary <a id="summary" href="/posts/central-repo#summary" class="anchor-link">ðŸ”—</a></h2><p>IN_PROGRESS</p>'}}]);